<script>
  const tablero = document.getElementById("tablero");
  const zonaInicial = document.getElementById("zona-inicial");

  // Crear casillas del tablero
  for (let i = 0; i < 25; i++) {
    const casilla = document.createElement("div");
    casilla.className = "casilla";
    casilla.id = "casilla-" + i;

    const etiqueta = document.createElement("span");
    etiqueta.className = "etiqueta";
    etiqueta.textContent = "C" + (i + 1);

    casilla.appendChild(etiqueta);
    tablero.appendChild(casilla);
  }

  // Crear casillas de inicio
  for (let i = 0; i < 8; i++) {
    const casilla = document.createElement("div");
    casilla.className = "casilla";
    casilla.id = "inicio-" + i;

    const etiqueta = document.createElement("span");
    etiqueta.className = "etiqueta";
    etiqueta.textContent = "I" + (i + 1);

    casilla.appendChild(etiqueta);
    zonaInicial.appendChild(casilla);
  }

  const fichas = [
    { id: "ficha1", src: "ficha1.png", casillaInicial: "inicio-0" },
    { id: "ficha2", src: "ficha2.png", casillaInicial: "inicio-1" },
    { id: "ficha3", src: "ficha3.png", casillaInicial: "inicio-2" },
    { id: "ficha4", src: "ficha4.png", casillaInicial: "inicio-3" },
    { id: "ficha5", src: "ficha5.png", casillaInicial: "inicio-4" },
    { id: "ficha6", src: "ficha6.png", casillaInicial: "inicio-5" },
    { id: "ficha7", src: "ficha7.png", casillaInicial: "inicio-6" },
    { id: "ficha8", src: "ficha8.png", casillaInicial: "inicio-7" }
  ];

  window.addEventListener("load", () => {
    // Crear e insertar fichas
    fichas.forEach(f => {
      const ficha = document.createElement("img");
      ficha.src = f.src;
      ficha.className = "ficha";
      ficha.draggable = true;
      ficha.id = f.id;

      const saved = localStorage.getItem(f.id);
      const target = document.getElementById(saved) || document.getElementById(f.casillaInicial);
      target.appendChild(ficha);

      ficha.addEventListener("dragstart", e => {
        e.dataTransfer.setData("text/plain", f.id);
      });
    });

    // Activar casillas receptivas
    document.querySelectorAll(".casilla").forEach(casilla => {
      casilla.addEventListener("dragover", e => e.preventDefault());
      casilla.addEventListener("drop", e => {
        e.preventDefault();
        const id = e.dataTransfer.getData("text/plain");
        const ficha = document.getElementById(id);
        casilla.appendChild(ficha);
        localStorage.setItem(id, casilla.id);
      });
    });

    // ✅ Función de reinicio (ahora sí funciona bien)
    window.reiniciarJuego = function () {
      fichas.forEach(f => {
        localStorage.removeItem(f.id);
        const ficha = document.getElementById(f.id);
        const casillaInicial = document.getElementById(f.casillaInicial);
        if (ficha && casillaInicial) {
          casillaInicial.appendChild(ficha);
        }
      });
    };
  });
</script>
